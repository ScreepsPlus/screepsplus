package auth

import (
	"testing"
)

func TestHashPassword(t *testing.T) {
	password := "password"
	res1, err := HashPassword(password)
	if err != nil {
		t.Fatal(err)
	}
	res2, err := HashPassword(password)
	if err != nil {
		t.Fatal(err)
	}
	if res1 == res2 {
		t.Fatalf("Hashes should not match! (No salt?)")
	}

	valid, err := VerifyPassword(res1, password)
	if err != nil {
		t.Fatal(err)
	}
	if !valid {
		t.Fatalf("Hash Invalid")
	}
}

func TestVerifyPassword(t *testing.T) {
	tables := []struct {
		hash     string
		password string
		ret      bool
	}{
		{"88012870f5369b433928d5d728b6ec8f1ddcae80a04a8917cf68ab7231de8562.731f21c0bc6027b05771590c94aadeac09f66f8cbe899a544379d5dea0d31376e41a1705ea140605e9c4eb7f7ad193fcf4ab3445f645377f696176de9ee8bf3d420c7069f7dda513740b233335b6c9f728515798cb517b00f8f191dadd3b8521feadf23248ff3935aceb081f662ebf18a930b7aac2d214cc343acdf1fc05346a2350538b59681d2c43c5c5d71c864a27850279cd9fa89e8bf050e651a725a512cc7f58b446ee480d0ff7e68a5a24cd153b8c022699e83875db2a2857c3394383d30b5c6c731132f50c01204b7d4e7b9ea98af3c5828432e95de41ffde19fb16488e24a267bb2d66571ba7016b78d9fd508a10a4a8bf8898b6eee9331ed5687498e7f4fdd8a90157efc66ce7f3b9f81389ded5ddb1a25d1ad400e7087ce4b25e1582b78095e7b36565cf86de74cb52e7d7c7bff0f61d4ec35aa09e3053c7aa4ef87b654066fa8407c69ba984f5766abc5fcaa13b39619e01e48424dcb9c0b5ea21183daaa69ae21ede49e797a2e62c059d10b30606b4677af10330e3b6253abdf0b0bdf74976f95bc617d382d6aed1a514ed1a967228a73edaa460c0aedbfb83814e87049db02fb9f9e051dc29b534af3952d2d7b5164e453921d7dfd1491302852b32e1172fd38c5019ebe6063f90ecb8d616c28e51391b21c51120edb232bcf460b910c3fb04d9d525a96194fc1f7103860751036501df415385442bc543d36", "qQUKTnzkTZoOPWz5jeDgaP8UJdFZvRHg", true},
		{"88012870f5369b433928d5d728b6ec8f1ddcae80a04a8917cf68ab7231de8562.731f21c0bc6027b05771590c94aadeac09f66f8cbe899a544379d5dea0d31376e41a1705ea140605e9c4eb7f7ad193fcf4ab3445f645377f696176de9ee8bf3d420c7069f7dda513740b233335b6c9f728515798cb517b00f8f191dadd3b8521feadf23248ff3935aceb081f662ebf18a930b7aac2d214cc343acdf1fc05346a2350538b59681d2c43c5c5d71c864a27850279cd9fa89e8bf050e651a725a512cc7f58b446ee480d0ff7e68a5a24cd153b8c022699e83875db2a2857c3394383d30b5c6c731132f50c01204b7d4e7b9ea98af3c5828432e95de41ffde19fb16488e24a267bb2d66571ba7016b78d9fd508a10a4a8bf8898b6eee9331ed5687498e7f4fdd8a90157efc66ce7f3b9f81389ded5ddb1a25d1ad400e7087ce4b25e1582b78095e7b36565cf86de74cb52e7d7c7bff0f61d4ec35aa09e3053c7aa4ef87b654066fa8407c69ba984f5766abc5fcaa13b39619e01e48424dcb9c0b5ea21183daaa69ae21ede49e797a2e62c059d10b30606b4677af10330e3b6253abdf0b0bdf74976f95bc617d382d6aed1a514ed1a967228a73edaa460c0aedbfb83814e87049db02fb9f9e051dc29b534af3952d2d7b5164e453921d7dfd1491302852b32e1172fd38c5019ebe6063f90ecb8d616c28e51391b21c51120edb232bcf460b910c3fb04d9d525a96194fc1f7103860751036501df415385442bc543d36", "wdMuACXIpxALGzhA74wWGeMh8WNY7BuF", false},
		{"e814c0a35581e22c4fd6412c2e332e935a1690a440293aa59c24c6f01c487b19.935a4aae4d9f166edf27eb38ffac3b1ea9714b97ba47ab7a249bf5e9981c39b1454189a702fbd0b1b4e3e68989a26ac7c71354966bebdd45944cc02314106ecdf2c69aaa44c6f1c03d6b1f1daaaa086cb49831d6f38eb17927f0ae3cf5967f83403b4c68595857baa8a7908a47a6b2ae8f7906b6c4220cde5f36ce7bcc62dee0e68704e094bd216bf098cc6b840ea3c6448b576b0c0cc7f310d1229ddfb03eb1c94dfdeeabbeb862e6e881c1ce6bdbddbeb5db9e741891cbda3bc18e8b63c424c5a67f2874d6e9386ea655776dd951942f9e115e089fb30a742625ac2391bb743c0f6cbfe4b38d47fce18f1f4296866fd3ec069f83825fda4cf8444e1442200c856f0cb2fb58dbb351daa376f968402d0b48cf49f30c26bb697d80af77f1157d64e3131a3f0b6f0c42625fc29146e8deb37751f5a70f47ac7f6b38cccd9bb63d71b6bdb0211b6194f797c4373c155cc5de9ccd22f989ad78541c1f8056487452ff7b845d9c2d8dd6483b352a372a81feef568dc5089b9e67c6d26bb9ba080f1000c03e4e10dc77d5a94d121cd5f44e844656553e922da4788c382b2cc1e51fedc477612ef4acc4031722e00d5d411533f7f9b816e30e06e5cae86cdb8e3bff761339ddf7951168c30dfb88351271f706d0655db235fe0e5162348b3d73e4505326563bc6e8586533f4133148e0d05c2be732bdd698ca37452c5e31887bea1a5a", "YO8BoFAqm3fwcC9Iqhe1Dv70Q2d40J5o", true},
	}
	for _, table := range tables {
		ret, err := VerifyPassword(table.hash, table.password)
		if err != nil {
			t.Fatal(err)
		}
		if ret != table.ret {
			t.Errorf("VerifyPassword(%.5s...,%s) was incorrect, got: %t, want: %t", table.hash, table.password, ret, table.ret)
		}
	}
}
